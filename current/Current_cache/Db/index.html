<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Db (current.Current_cache.Db)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current_cache</a> &#x00BB; Db</nav><header class="odoc-preamble"><h1>Module <code><span>Current_cache.Db</span></code></h1><p>Low-level database access (for the web UI and plugins).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-entry"><a href="#type-entry" class="anchor"></a><code><span><span class="keyword">type</span> entry</span><span> = </span><span>{</span></code><ol><li id="type-entry.job_id" class="def record field anchored"><a href="#type-entry.job_id" class="anchor"></a><code><span>job_id : string;</span></code></li><li id="type-entry.build" class="def record field anchored"><a href="#type-entry.build" class="anchor"></a><code><span>build : int64;</span></code></li><li id="type-entry.value" class="def record field anchored"><a href="#type-entry.value" class="anchor"></a><code><span>value : string;</span></code></li><li id="type-entry.outcome" class="def record field anchored"><a href="#type-entry.outcome" class="anchor"></a><code><span>outcome : <span>string <a href="../../Current/index.html#type-or_error">Current.or_error</a></span>;</span></code></li><li id="type-entry.ready" class="def record field anchored"><a href="#type-entry.ready" class="anchor"></a><code><span>ready : float;</span></code></li><li id="type-entry.running" class="def record field anchored"><a href="#type-entry.running" class="anchor"></a><code><span>running : <span>float option</span>;</span></code></li><li id="type-entry.finished" class="def record field anchored"><a href="#type-entry.finished" class="anchor"></a><code><span>finished : float;</span></code></li><li id="type-entry.rebuild" class="def record field anchored"><a href="#type-entry.rebuild" class="anchor"></a><code><span>rebuild : bool;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Ensure that the database tables have been created. This is useful if you need to refer to them in your own SQL.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : 
  <span>?op:string <span class="arrow">&#45;&gt;</span></span>
  <span>?ok:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?rebuild:bool <span class="arrow">&#45;&gt;</span></span>
  <span>?job_prefix:string <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-entry">entry</a> list</span></span></code></div><div class="spec-doc"><p>Search the database for matching records.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">op</span> <p>: if present, restrict to results from the named builder or publisher</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ok</span> <p>: if present, restrict results to passing (ok=true) or failing (ok=false) results.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">rebuild</span> <p>: if present, restrict results to ones where the rebuild flag matches this.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">job_prefix</span> <p>: if present, restrict results to ones where the job ID starts with this string.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ops"><a href="#val-ops" class="anchor"></a><code><span><span class="keyword">val</span> ops : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string list</span></span></code></div><div class="spec-doc"><p><code>ops ()</code> is the list of operation types that can be passed to <code>query</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-history"><a href="#val-history" class="anchor"></a><code><span><span class="keyword">val</span> history : <span>limit:int <span class="arrow">&#45;&gt;</span></span> <span>job_id:string <span class="arrow">&#45;&gt;</span></span> <span>string option</span> * <span><a href="#type-entry">entry</a> list</span></span></code></div><div class="spec-doc"><p><code>history ~limit ~job_id</code> returns the in-progress build (if any), and the <code>limit</code> most recent builds with the same key as <code>job_id</code>.</p></div></div></div></body></html>