<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Engine (current.Current.Engine)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current</a> &#x00BB; Engine</nav><header class="odoc-preamble"><h1>Module <code><span>Current.Engine</span></code></h1><p>The main event loop.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-results" class="anchored"><a href="#type-results" class="anchor"></a><code><span><span class="keyword">type</span> results</span><span> = </span><span>{</span></code><table><tr id="type-results.value" class="anchored"><td class="def record field"><a href="#type-results.value" class="anchor"></a><code><span>value : <span>unit <a href="../../Current_term/Output/index.html#type-t">Current_term.Output.t</a></span>;</span></code></td></tr><tr id="type-results.jobs" class="anchored"><td class="def record field"><a href="#type-results.jobs" class="anchor"></a><code><span>jobs : <span><a href="../class-type-actions/index.html">actions</a> <span class="xref-unresolved">Job</span>.Map.t</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>The jobs currently being used (whether running or finished).</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create" class="anchored"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span>?config:<a href="../Config/index.html#type-t">Config.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?trace:<span>( <span>next:<span>unit <span class="xref-unresolved">Lwt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-results">results</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-term">term</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create pipeline</code> is a new engine running <code>pipeline</code>. The engine will evaluate <code>t</code>'s pipeline immediately, and again whenever one of its inputs changes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-update" class="anchored"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Primitives should call this after using <code>Current_incr</code>.change to run another step of the engine loop. This will (asynchronously) call <code>Current_incr</code>.propagate and perform any end-of-propagation activities.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-state" class="anchored"><a href="#val-state" class="anchor"></a><code><span><span class="keyword">val</span> state : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-results">results</a></span></code></div><div class="spec-doc"><p>The most recent results from evaluating the pipeline.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-jobs" class="anchored"><a href="#val-jobs" class="anchor"></a><code><span><span class="keyword">val</span> jobs : <span><a href="#type-results">results</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../class-type-actions/index.html">actions</a> <span class="xref-unresolved">Job</span>.Map.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-thread" class="anchored"><a href="#val-thread" class="anchor"></a><code><span><span class="keyword">val</span> thread : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>thread t</code> is the engine's thread. Use this to monitor the engine (in case it crashes).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-config" class="anchored"><a href="#val-config" class="anchor"></a><code><span><span class="keyword">val</span> config : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Config/index.html#type-t">Config.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pipeline" class="anchored"><a href="#val-pipeline" class="anchor"></a><code><span><span class="keyword">val</span> pipeline : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-term">term</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-update_metrics" class="anchored"><a href="#val-update_metrics" class="anchor"></a><code><span><span class="keyword">val</span> update_metrics : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>update_metrics t</code> reports how many pipeline stages are in each state via Prometheus. Call this on each metrics collection if you have exactly one pipeline. The default web UI does this automatically.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-on_disable" class="anchored"><a href="#val-on_disable" class="anchor"></a><code><span><span class="keyword">val</span> on_disable : <span><span>( <span>unit <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>on_disable fn</code> schedules <code>fn ()</code> to be called after the next evaluation. You can increment a ref-count when calling this and then check it when the callback is called. If it is then zero, the operation is no longer required and you can e.g. cancel the job.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Step" class="anchored"><a href="#module-Step" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Step/index.html">Step</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>