<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Switch (current.Current.Switch)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current</a> &#x00BB; Switch</nav><header class="odoc-preamble"><h1>Module <code><span>Current.Switch</span></code></h1><p>Like <code>Lwt_switch</code>, but the cleanup functions are called in sequence, not in parallel.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>A switch limits the lifetime of an operation. Cleanup operations can be registered against the switch and will be called (in reverse order) when the switch is turned off.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>label:string <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ~label ()</code> is a fresh switch, initially on.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>If the switch is GC'd while on, this is logged in the error message.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_off"><a href="#val-create_off" class="anchor"></a><code><span><span class="keyword">val</span> create_off : <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create_off ()</code> is a fresh switch, initially (and always) off.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_hook_or_exec"><a href="#val-add_hook_or_exec" class="anchor"></a><code><span><span class="keyword">val</span> add_hook_or_exec : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>add_hook_or_exec switch fn</code> pushes <code>fn</code> on to the stack of functions to call when <code>t</code> is turned off. If <code>t</code> is already off, calls <code>fn</code> immediately. If <code>t</code> is in the process of being turned off, waits for that to complete and then runs <code>fn</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-turn_off"><a href="#val-turn_off" class="anchor"></a><code><span><span class="keyword">val</span> turn_off : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>turn_off t</code> marks the switch as being turned off, then pops and calls clean-up functions in order. When the last one finishes, the switch is marked as off and cannot be used again. If the switch is already off, this does nothing. If the switch is already being turned off, it just waits for that to complete.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_on"><a href="#val-is_on" class="anchor"></a><code><span><span class="keyword">val</span> is_on : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_on t</code> is <code>true</code> if <code>turn_off t</code> hasn't yet been called.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><a href="#type-t">t</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p>Prints the state of the switch (for debugging).</p></div></div></div></body></html>