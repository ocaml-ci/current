<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Current (current.Current)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">current</a> &#x00BB; Current</nav><header class="odoc-preamble"><h1>Module <code><span>Current</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-or_error"><a href="#type-or_error" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a or_error</span></span><span> = <span><span>(<span class="type-var">'a</span>, <span>[ <span>`Msg of string</span> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Level"><a href="#module-Level" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Level/index.html">Level</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Each operation has a level, giving an estimate of the cost or risk of the operation. When testing a pipeline, it can be useful to set a maximum level, or to require confirmation for more risky operations.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Config"><a href="#module-Config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Config/index.html">Config</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-job_id"><a href="#type-job_id" class="anchor"></a><code><span><span class="keyword">type</span> job_id</span><span> = string</span></code></div></div><div class="odoc-spec"><div class="spec class-type anchored" id="class-type-actions"><a href="#class-type-actions" class="anchor"></a><code><span><span class="keyword">class</span> <span class="keyword">type</span>  </span><span><a href="class-type-actions/index.html">actions</a></span><span> = <span class="keyword">object</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Metadata"><a href="#module-Metadata" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Metadata/index.html">Metadata</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Metadata associated with primitive terms.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Primitive"><a href="#module-Primitive" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Primitive/index.html">Primitive</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An OCurrent pipeline is made up of primitive operations. A primitive is roughly the content of a single box in the diagram.</p></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../Current_term/S/module-type-TERM/index.html">Current_term.S.TERM</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Current_term/S/module-type-TERM/index.html#type-metadata">metadata</a> := <a href="Metadata/index.html#type-t">Metadata.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <span>'a <a href="../Current_term/S/module-type-TERM/index.html#type-primitive">primitive</a></span> := <span><span class="type-var">'a</span> <a href="Primitive/index.html#type-t">Primitive.t</a></span></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>An <code>'a t</code> is a term that produces a value of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-description"><a href="#type-description" class="anchor"></a><code><span><span class="keyword">type</span> description</span></code></div><div class="spec-doc"><p>Information about operations hidden behind a bind.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-active"><a href="#val-active" class="anchor"></a><code><span><span class="keyword">val</span> active : <span><a href="../Current_term/Output/index.html#type-active">Current_term.Output.active</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>active x</code> is a term indicating that the result is not determined yet.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="optlabel">?label</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return x</code> is a term that immediately succeeds with <code>x</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>Label the constant in the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fail m</code> is a term that immediately fails with message <code>m</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-state"><a href="#val-state" class="anchor"></a><code><span><span class="keyword">val</span> state : 
  <span><span class="optlabel">?hidden</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span>[ <span>`Active of <a href="../Current_term/Output/index.html#type-active">Current_term.Output.active</a></span> <span><span>| `Msg</span> of string</span> ]</span>)</span>
    <span class="xref-unresolved">Stdlib</span>.result</span>
    <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>state t</code> always immediately returns a successful result giving the current state of <code>t</code>.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">hidden</span> <p>If <code>true</code>, don't show a separate node for this on the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-catch"><a href="#val-catch" class="anchor"></a><code><span><span class="keyword">val</span> catch : <span><span class="optlabel">?hidden</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Current_term/S/index.html#type-or_error">Current_term.S.or_error</a></span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>catch t</code> successfully returns <code>Ok x</code> if <code>t</code> evaluates successfully to <code>x</code>, or successfully returns <code>Error e</code> if <code>t</code> fails with error <code>e</code>. If <code>t</code> is active then <code>catch t</code> will be active too.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">hidden</span> <p>If <code>true</code>, don't show a separate node for this on the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ignore_value"><a href="#val-ignore_value" class="anchor"></a><code><span><span class="keyword">val</span> ignore_value : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>ignore_value x</code> is <code>map ignore x</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_output"><a href="#val-of_output" class="anchor"></a><code><span><span class="keyword">val</span> of_output : <span><span><span class="type-var">'a</span> <a href="../Current_term/Output/index.html#type-t">Current_term.Output.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_output x</code> is a returned, failed or active term.</p></div></div><h2 id="sequencing-terms"><a href="#sequencing-terms" class="anchor"></a>Sequencing terms</h2><h3 id="applicative-operations"><a href="#applicative-operations" class="anchor"></a>Applicative operations</h3><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span class="optlabel">?eq</span>:<span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f x</code> is a term that runs <code>x</code> and then transforms the result using <code>f</code>.</p><p>The optional equality function <code>?eq</code> defaults to physical equality. When <code>f</code> produces an updated result following a change in <code>x</code>, the equality function will be called with the previous and the new value <code>eq b_old b_new</code>: returning <code>true</code> indicates that the change can be ignored and should not propagate further down the pipeline.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map_error"><a href="#val-map_error" class="anchor"></a><code><span><span class="keyword">val</span> map_error : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> string)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map_error f x</code> is a term that runs <code>x</code> and then transforms the error string (if any) using <code>f</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span><span class="keyword">val</span> pair : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pair a b</code> is the pair containing the results of evaluating <code>a</code> and <code>b</code> (in parallel).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_map"><a href="#val-list_map" class="anchor"></a><code><span><span class="keyword">val</span> list_map : 
  <span><span>(<span class="keyword">module</span> <a href="../Current_term/S/module-type-ORDERED/index.html">Current_term.S.ORDERED</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Current_term/S/module-type-ORDERED/index.html#type-t">t</a> = <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?collapse_key</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?label</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'b</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>list_map (module T) f xs</code> adds <code>f</code> to the end of each input term and collects all the results into a single list.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">T</span> <p>Used to display labels for each item, and to avoid recreating pipelines unnecessarily.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">collapse_key</span> <p>If given, each element is wrapped with <code>collapse</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>Label the list in the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_iter"><a href="#val-list_iter" class="anchor"></a><code><span><span class="keyword">val</span> list_iter : 
  <span><span>(<span class="keyword">module</span> <a href="../Current_term/S/module-type-ORDERED/index.html">Current_term.S.ORDERED</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../Current_term/S/module-type-ORDERED/index.html#type-t">t</a> = <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?collapse_key</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?label</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Like <code>list_map</code> but for the simpler case when the result is unit.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>Label the list in the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list_seq"><a href="#val-list_seq" class="anchor"></a><code><span><span class="keyword">val</span> list_seq : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>list_seq x</code> evaluates to a list containing the results of evaluating each element in <code>x</code>, once all elements of <code>x</code> have successfully completed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-option_map"><a href="#val-option_map" class="anchor"></a><code><span><span class="keyword">val</span> option_map : <span><span class="optlabel">?label</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>option_map f x</code> is a term that evaluates to <code>Some (f y)</code> if <code>x</code> evaluates to <code>Some y</code>, or to <code>None</code> otherwise.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>Label the optional in the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-option_iter"><a href="#val-option_iter" class="anchor"></a><code><span><span class="keyword">val</span> option_iter : <span><span class="optlabel">?label</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Like <code>option_map</code> but for the simpler case when the result is unit.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">label</span> <p>Label the list in the diagrams.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-option_seq"><a href="#val-option_seq" class="anchor"></a><code><span><span class="keyword">val</span> option_seq : <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> option</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>option_seq None</code> is <code>Current.return None</code> and <code>option_seq (Some x)</code> is <code>Current.map some x</code>. This is useful for handling optional arguments that are currents.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all"><a href="#val-all" class="anchor"></a><code><span><span class="keyword">val</span> all : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>all xs</code> is a term that succeeds if every term in <code>xs</code> succeeds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all_labelled"><a href="#val-all_labelled" class="anchor"></a><code><span><span class="keyword">val</span> all_labelled : <span><span><span>(string * <span>unit <a href="#type-t">t</a></span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>all xs</code> is a term that succeeds if every term in <code>xs</code> succeeds. The labels are used if some terms fail, to indicate which ones are failing.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-gate"><a href="#val-gate" class="anchor"></a><code><span><span class="keyword">val</span> gate : <span><span class="label">on</span>:<span>unit <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>gate ~on:ctrl x</code> is the same as <code>x</code>, once <code>ctrl</code> succeeds.</p><p>Note: <code>gate</code> does <i>not</i> delay <code>x</code>; it only delays whatever you put after the gate. e.g.</p><pre class="language-ocaml"><code>let binary = build src in
let tests_ok = test binary in
binary |&gt; gate ~on:tests_ok |&gt; deploy</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-cutoff"><a href="#val-cutoff" class="anchor"></a><code><span><span class="keyword">val</span> cutoff : <span><span class="label">eq</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>cutoff ~eq x</code> is the same as <code>x</code>, but changes to <code>x</code> that are equal according to <code>eq</code> do not propagate further down. It should be used when values of type <code>'a</code> have a precise definition of equality to avoid triggering redundant work.</p></div></div><h3 id="diagram-control"><a href="#diagram-control" class="anchor"></a>Diagram control</h3><div class="odoc-spec"><div class="spec value anchored" id="val-collapse"><a href="#val-collapse" class="anchor"></a><code><span><span class="keyword">val</span> collapse : <span><span class="label">key</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">value</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">input</span>:<span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>collapse ~key ~value ~input t</code> is a term that behaves just like <code>t</code>, but when shown in a diagram it can be expanded or collapsed. When collapsed, it is shown as &quot;input -&gt; <code>+</code>&quot; and the user can expand it to show <code>t</code> instead. The idea is that <code>input</code> is a dependency of <code>t</code> and the &quot;+&quot; represents everything in <code>t</code> after that. <code>key</code> and <code>value</code> are used as the parameters (e.g. in a URL) to control whether this is expanded or not. For example <code>collapse ~key:&quot;repo&quot; ~value:&quot;mirage/mirage-www&quot; ~input:repo (process repo)</code> Note: <code>list_map ~collapse_key</code> provides an easy way to use this.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-collapse_list"><a href="#val-collapse_list" class="anchor"></a><code><span><span class="keyword">val</span> collapse_list : 
  <span><span class="label">key</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">value</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">input</span>:<span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> list</span> * <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>collapse_list ~key ~value ~input t</code> is a term that behaves just like <code>t</code> list, but when shown in a diagram it can be expanded or collapsed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_context"><a href="#val-with_context" class="anchor"></a><code><span><span class="keyword">val</span> with_context : <span><span><span class="type-var">_</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>with_context ctx f</code> is the term <code>f ()</code>, where <code>f</code> is evaluated in context <code>ctx</code>. This means that <code>ctx</code> will be treated as an input to all terms created by <code>f</code> in the diagrams.</p></div></div><h3 id="monadic-operations"><a href="#monadic-operations" class="anchor"></a>Monadic operations</h3><p><b>N.B.</b> these operations create terms that cannot be statically analysed until after they are executed.</p><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : 
  <span><span class="optlabel">?info</span>:<a href="#type-description">description</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?eq</span>:<span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind f x</code> is a term that first runs <code>x</code> to get <code>y</code> and then behaves as the term <code>f y</code>. Static analysis cannot look inside the <code>f</code> function until <code>x</code> is ready, so using <code>bind</code> makes static analysis less useful. You can use the <code>info</code> argument to provide some information here.</p></div></div><h3 id="primitives"><a href="#primitives" class="anchor"></a>Primitives</h3><div class="odoc-spec"><div class="spec value anchored" id="val-primitive"><a href="#val-primitive" class="anchor"></a><code><span><span class="keyword">val</span> primitive : <span><span class="label">info</span>:<a href="#type-description">description</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="Primitive/index.html#type-t">Primitive.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>primitive ~info f x</code> is a term that evaluates <code>f</code> on each new value of <code>x</code>. This is used to provide the primitive operations, which can then be combined using the other combinators in this module. <code>info</code> is used to label the operation in the diagram.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-component"><a href="#val-component" class="anchor"></a><code><span><span class="keyword">val</span> component : 
  <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <a href="#type-description">description</a>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>component name</code> is used to annotate binds, so that the system can show a name for the operations hidden inside the bind's function. <code>name</code> is used as the label for the bind in the generated dot diagrams. For convenience, <code>name</code> can also be a format string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-observe"><a href="#val-observe" class="anchor"></a><code><span><span class="keyword">val</span> observe : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../Current_term/Output/Blockable/index.html#type-t">Current_term.Output.Blockable.t</a></span></span></code></div><div class="spec-doc"><p><code>observe x</code> evaluates the current state of term <code>x</code>. A <code>`Blocked</code> value occurs when the term failed because an upstream dependency errored.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Syntax"><a href="#module-Syntax" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Syntax/index.html">Syntax</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Monitor"><a href="#module-Monitor" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Monitor/index.html">Monitor</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A monitor is an input pipeline stage that can watch for external events.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-term"><a href="#type-term" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a term</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An alias of <code>t</code> to make it easy to refer to later in this file.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Analysis"><a href="#module-Analysis" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Analysis/index.html">Analysis</a></span><span> : 
  <a href="../Current_term/S/module-type-ANALYSIS/index.html">Current_term.S.ANALYSIS</a>
    <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="../Current_term/S/module-type-ANALYSIS/index.html#type-term">term</a></span> := <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span>
     <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../Current_term/S/module-type-ANALYSIS/index.html#type-metadata">metadata</a> := <a href="Metadata/index.html#type-t">Metadata.t</a></span></span></code></div><div class="spec-doc"><p>Diagram generation, introspection, and statistics.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Var"><a href="#module-Var" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Var/index.html">Var</a></span><span> (<a href="Var/argument-1-T/index.html">T</a> : <a href="../Current_term/S/module-type-T/index.html">Current_term.S.T</a>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Variable pipeline inputs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-state_dir"><a href="#val-state_dir" class="anchor"></a><code><span><span class="keyword">val</span> state_dir : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Fpath</span>.t</span></code></div><div class="spec-doc"><p><code>state_dir name</code> is a directory under which state (build results, logs) can be stored. <code>name</code> identifies the sub-component of OCurrent, each of which gets its own subdirectory.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-String"><a href="#module-String" class="anchor"></a><code><span><span class="keyword">module</span> <a href="String/index.html">String</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Unit"><a href="#module-Unit" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Unit/index.html">Unit</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Switch"><a href="#module-Switch" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Switch/index.html">Switch</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Like <code>Lwt_switch</code>, but the cleanup functions are called in sequence, not in parallel.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Pool"><a href="#module-Pool" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Pool/index.html">Pool</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Resource pools, to control how many jobs can use a resource at a time. To use a pool within a job, pass the pool to <a href="Job/index.html#val-start"><code>Job.start</code></a> or call <a href="Job/index.html#val-use_pool"><code>Job.use_pool</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Job"><a href="#module-Job" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Job/index.html">Job</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Jobs with log files. This is mostly an internal interface - use <a href="../Current_cache/index.html"><code>Current_cache</code></a> instead.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Engine"><a href="#module-Engine" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Engine/index.html">Engine</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The main event loop.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Process"><a href="#module-Process" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Process/index.html">Process</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Helper functions for spawning sub-processes.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Db"><a href="#module-Db" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Db/index.html">Db</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Access to the sqlite database.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Log_matcher"><a href="#module-Log_matcher" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Log_matcher/index.html">Log_matcher</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Analysing job logs.</p></div></div></div></body></html>
